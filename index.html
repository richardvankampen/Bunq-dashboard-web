<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bunq Financial Dashboard - Premium Analytics</title>
    
    <!-- Plotly for advanced visualizations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.27.0/plotly.min.js"
            integrity="sha384-Hl48Kq2HifOWdXEjMsKo6qxqvRLTYqIGbvlENBmkHAxZKIGCXv43H6W1jA671RzC"
            crossorigin="anonymous"></script>
    
    <!-- Chart.js for additional chart types -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"
            integrity="sha384-DhxhYObIMeMNGyAG7iK11OHzBIKyEIeRL0ad1iFPAOwZB8iirUlTT0O/WJJUk8+o"
            crossorigin="anonymous"></script>
    
    <!-- Particles.js for background effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"
            integrity="sha384-d+UOwmNNIC7V4izkTAKSXzWhjC2GxiS9PTykO1XdOPC3nc2z65UOS7SP6QdKPA70"
            crossorigin="anonymous"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
          integrity="sha384-iw3OoTErCYJJB9mCa8LNS2hbsQ7M3C0EpIsO/H5+EGAkPGc6rk+V8i04oW/K5xq0"
          crossorigin="anonymous">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body class="dark-theme">
    <!-- Animated Background Particles -->
    <div id="particles-js"></div>
    
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loader">
            <div class="loader-ring"></div>
            <div class="loader-ring"></div>
            <div class="loader-ring"></div>
            <div class="loader-text">
                <i class="fas fa-wallet"></i>
                <p>Loading Bunq Data...</p>
            </div>
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="dashboard-container" id="main-content" style="display: none;">
        
        <!-- Header Section -->
        <header class="dashboard-header glass-effect">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Bunq Financial Dashboard</h1>
                        <p class="subtitle">Real-time Analytics & Insights</p>
                    </div>
                </div>
                
                <div class="header-controls">
                    <!-- Time Range Selector -->
                    <div class="control-group glass-effect">
                        <i class="fas fa-calendar-alt"></i>
                        <select id="timeRange" class="time-selector">
                            <option value="7">Last 7 days</option>
                            <option value="30">Last 30 days</option>
                            <option value="90" selected>Last 3 months</option>
                            <option value="180">Last 6 months</option>
                            <option value="365">Last year</option>
                            <option value="all">All time</option>
                        </select>
                    </div>
                    
                    <!-- Refresh Button -->
                    <button class="refresh-btn glass-effect" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh</span>
                    </button>
                    
                    <!-- Theme Toggle -->
                    <button class="theme-toggle glass-effect" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    
                    <!-- Settings -->
                    <button class="settings-btn glass-effect" id="settingsBtn">
                        <i class="fas fa-cog"></i>
                    </button>

                    <!-- Auth Controls -->
                    <div class="auth-controls">
                        <span id="userDisplay" style="display: none;"></span>
                        <button id="loginBtn" class="btn-icon" title="Login">
                            <i class="fas fa-sign-in-alt"></i>
                        </button>
                        <button id="logoutBtn" class="btn-icon" style="display: none;" title="Logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Last Updated Info -->
            <div class="update-info">
                <i class="fas fa-clock"></i>
                <span id="lastUpdate">Last updated: Never</span>
            </div>
        </header>
        
        <!-- KPI Cards Section -->
        <section class="kpi-section">
            <div class="kpi-grid">
                <!-- Total Checking Balance -->
                <div class="kpi-card glass-effect balance-card clickable-kpi" data-account-type="checking" data-aos="fade-up" data-aos-delay="0">
                    <div class="kpi-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="kpi-content">
                        <p class="kpi-label">Betaalrekeningen (totaal)</p>
                        <h2 class="kpi-value" id="checkingBalance">€0</h2>
                        <div class="kpi-trend neutral">
                            <i class="fas fa-chart-line"></i>
                            <span id="checkingTrend">0%</span>
                        </div>
                    </div>
                    <div class="kpi-sparkline">
                        <canvas id="checkingSparkline"></canvas>
                    </div>
                </div>

                <!-- Total Savings Balance -->
                <div class="kpi-card glass-effect balance-card clickable-kpi" data-account-type="savings" data-aos="fade-up" data-aos-delay="100">
                    <div class="kpi-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <div class="kpi-content">
                        <p class="kpi-label">Spaarrekeningen (totaal)</p>
                        <h2 class="kpi-value" id="savingsBalance">€0</h2>
                        <div class="kpi-trend neutral">
                            <i class="fas fa-chart-line"></i>
                            <span id="savingsBalanceTrend">0%</span>
                        </div>
                    </div>
                    <div class="kpi-sparkline">
                        <canvas id="savingsBalanceSparkline"></canvas>
                    </div>
                </div>

                <!-- Total Income Card -->
                <div class="kpi-card glass-effect income-card" data-aos="fade-up" data-aos-delay="200">
                    <div class="kpi-icon">
                        <i class="fas fa-arrow-trend-up"></i>
                    </div>
                    <div class="kpi-content">
                        <p class="kpi-label">Total Income</p>
                        <h2 class="kpi-value" id="totalIncome">€0</h2>
                        <div class="kpi-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="incomeTrend">0%</span>
                        </div>
                    </div>
                    <div class="kpi-sparkline">
                        <canvas id="incomeSparkline"></canvas>
                    </div>
                </div>
                
                <!-- Total Expenses Card -->
                <div class="kpi-card glass-effect expense-card" data-aos="fade-up" data-aos-delay="300">
                    <div class="kpi-icon">
                        <i class="fas fa-arrow-trend-down"></i>
                    </div>
                    <div class="kpi-content">
                        <p class="kpi-label">Total Expenses</p>
                        <h2 class="kpi-value" id="totalExpenses">€0</h2>
                        <div class="kpi-trend negative">
                            <i class="fas fa-arrow-down"></i>
                            <span id="expensesTrend">0%</span>
                        </div>
                    </div>
                    <div class="kpi-sparkline">
                        <canvas id="expensesSparkline"></canvas>
                    </div>
                </div>
                
                <!-- Net Savings Card -->
                <div class="kpi-card glass-effect savings-card" data-aos="fade-up" data-aos-delay="400">
                    <div class="kpi-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <div class="kpi-content">
                        <p class="kpi-label">Net Savings</p>
                        <h2 class="kpi-value" id="netSavings">€0</h2>
                        <div class="kpi-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="savingsTrend">0%</span>
                        </div>
                    </div>
                    <div class="kpi-sparkline">
                        <canvas id="savingsSparkline"></canvas>
                    </div>
                </div>
                
                <!-- Savings Rate Card -->
                <div class="kpi-card glass-effect rate-card" data-aos="fade-up" data-aos-delay="500">
                    <div class="kpi-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="kpi-content">
                        <p class="kpi-label">Savings Rate</p>
                        <h2 class="kpi-value" id="savingsRate">0%</h2>
                        <div class="progress-ring">
                            <svg class="progress-svg" width="60" height="60">
                                <circle class="progress-circle-bg" cx="30" cy="30" r="25"></circle>
                                <circle class="progress-circle" id="savingsCircle" cx="30" cy="30" r="25"></circle>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Main Visualizations Grid -->
        <section class="visualizations-section">
            
            <!-- Row 1: Main Charts -->
            <div class="viz-row">
                <!-- Cashflow Timeline (Large) -->
                <div class="viz-card glass-effect large-card" data-aos="fade-up">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Cashflow Timeline</h3>
                        <div class="card-actions">
                            <button class="action-btn" title="Fullscreen">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="action-btn" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="cashflowChart"></div>
                    </div>
                </div>
            </div>
            
            <!-- Row 2: Medium Charts -->
            <div class="viz-row two-col">
                <!-- Sankey Diagram -->
                <div class="viz-card glass-effect" data-aos="fade-up" data-aos-delay="100">
                    <div class="card-header">
                        <h3><i class="fas fa-project-diagram"></i> Money Flow (Sankey)</h3>
                        <div class="card-actions">
                            <button class="action-btn" title="Fullscreen">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="sankeyChart"></div>
                    </div>
                </div>
                
                <!-- Category Sunburst -->
                <div class="viz-card glass-effect" data-aos="fade-up" data-aos-delay="200">
                    <div class="card-header">
                        <h3><i class="fas fa-circle-notch"></i> Category Breakdown</h3>
                        <div class="card-actions">
                            <button class="action-btn" title="Fullscreen">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="sunburstChart"></div>
                    </div>
                </div>
            </div>
            
            <!-- Row 3: 3D Time Travel (Full Width) -->
            <div class="viz-row">
                <div class="viz-card glass-effect large-card featured-card" data-aos="fade-up">
                    <div class="card-header">
                        <h3><i class="fas fa-cube"></i> 3D Time-Space Journey</h3>
                        <div class="animation-controls">
                            <button class="play-btn" id="play3D">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="action-btn">
                                <i class="fas fa-rotate"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="timeTravelChart"></div>
                    </div>
                </div>
            </div>
            
            <!-- Row 4: Additional Charts -->
            <div class="viz-row three-col">
                <!-- Heatmap -->
                <div class="viz-card glass-effect" data-aos="fade-up">
                    <div class="card-header">
                        <h3><i class="fas fa-fire"></i> Day Pattern</h3>
                    </div>
                    <div class="card-body">
                        <div id="heatmapChart"></div>
                    </div>
                </div>
                
                <!-- Top Merchants -->
                <div class="viz-card glass-effect" data-aos="fade-up" data-aos-delay="100">
                    <div class="card-header">
                        <h3><i class="fas fa-store"></i> Top Merchants</h3>
                    </div>
                    <div class="card-body">
                        <div id="merchantsChart"></div>
                    </div>
                </div>
                
                <!-- Ridge Plot Preview -->
                <div class="viz-card glass-effect" data-aos="fade-up" data-aos-delay="200">
                    <div class="card-header">
                        <h3><i class="fas fa-mountain"></i> Monthly Distribution</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="ridgePlotCanvas"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Row 5: Racing Bar Chart (Animated) -->
            <div class="viz-row">
                <div class="viz-card glass-effect large-card featured-card" data-aos="fade-up">
                    <div class="card-header">
                        <h3><i class="fas fa-trophy"></i> Category Race Over Time</h3>
                        <div class="animation-controls">
                            <button class="play-btn" id="playRace">
                                <i class="fas fa-play"></i>
                            </button>
                            <input type="range" id="raceSlider" min="0" max="100" value="0" class="race-slider">
                            <span class="race-month" id="raceMonth">Month 1</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="racingChart"></div>
                    </div>
                </div>
            </div>
            
        </section>
        
        <!-- Insights Section -->
        <section class="insights-section">
            <div class="insights-grid">
                <div class="insight-card glass-effect" data-aos="fade-up">
                    <i class="fas fa-lightbulb insight-icon"></i>
                    <h4>Biggest Category</h4>
                    <p id="biggestCategory">Loading...</p>
                </div>
                <div class="insight-card glass-effect" data-aos="fade-up" data-aos-delay="100">
                    <i class="fas fa-chart-simple insight-icon"></i>
                    <h4>Average Daily Spending</h4>
                    <p id="avgDaily">Loading...</p>
                </div>
                <div class="insight-card glass-effect" data-aos="fade-up" data-aos-delay="200">
                    <i class="fas fa-calendar-day insight-icon"></i>
                    <h4>Most Expensive Day</h4>
                    <p id="expensiveDay">Loading...</p>
                </div>
                <div class="insight-card glass-effect" data-aos="fade-up" data-aos-delay="300">
                    <i class="fas fa-rocket insight-icon"></i>
                    <h4>Trend</h4>
                    <p id="trendInsight">Loading...</p>
                </div>
            </div>
        </section>
        
        <!-- Footer -->
        <footer class="dashboard-footer glass-effect">
            <div class="footer-content">
                <p>
                    <i class="fas fa-lock"></i> 
                    Secure connection to Bunq API | 
                    <i class="fas fa-server"></i> 
                    Hosted on your NAS | 
                    <i class="fas fa-shield-halved"></i> 
                    Your data stays private
                </p>
                <p class="footer-credit">
                    Built with ❤️ using Plotly, Chart.js & Modern Web Technologies
                </p>
            </div>
        </footer>
        
    </div>
    
    <!-- Login Modal -->
    <div id="loginModal" class="modal login-modal">
        <div class="modal-content glass-effect login-modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-lock"></i> Login Required</h2>
                <button class="close-modal" id="closeLogin">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="loginUsername">
                            <i class="fas fa-user"></i> Username
                        </label>
                        <input 
                            type="text" 
                            id="loginUsername" 
                            name="username" 
                            required 
                            autocomplete="username"
                            placeholder="Enter username"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">
                            <i class="fas fa-lock"></i> Password
                        </label>
                        <input 
                            type="password" 
                            id="loginPassword" 
                            name="password" 
                            required 
                            autocomplete="current-password"
                            placeholder="Enter password"
                        >
                    </div>
                    
                    <button type="submit" id="loginSubmit" class="btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    
                    <p class="login-help">
                        <i class="fas fa-info-circle"></i> 
                        Use the credentials configured in your .env file
                    </p>
                </form>
            </div>
        </div>
    </div>

    <!-- Balance Detail Modal -->
    <div id="balanceDetailModal" class="modal">
        <div class="modal-content glass-effect">
            <div class="modal-header">
                <h2 id="balanceDetailTitle"><i class="fas fa-wallet"></i> Saldoverdeling</h2>
                <button class="close-modal" id="closeBalanceDetail">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="balanceDetailSummary" class="balance-detail-summary"></p>
                <div id="balanceDetailChart" class="balance-detail-chart"></div>
                <div id="balanceDetailList" class="balance-detail-list"></div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content glass-effect">
            <div class="modal-header">
                <h2><i class="fas fa-cog"></i> Settings</h2>
                <button class="close-modal" id="closeSettings">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label>API Endpoint URL</label>
                    <input type="text" id="apiEndpoint" placeholder="http://your-nas-ip:5000/api" value="http://localhost:5000/api">
                </div>
                <div class="setting-group">
                    <label>Auto-refresh interval (minutes)</label>
                    <input type="number" id="refreshInterval" min="0" max="60" value="0" placeholder="0 = disabled">
                </div>
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="enableAnimations" checked>
                        Enable animations
                    </label>
                </div>
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="enableParticles" checked>
                        Enable background particles
                    </label>
                </div>
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="excludeInternalTransfers" checked>
                        Exclude internal transfers (recommended)
                    </label>
                    <p class="setting-help">Transfers between your own Bunq accounts won't count as income or expense.</p>
                </div>
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="useRealData">
                        Use real Bunq data (requires login)
                    </label>
                    <p class="setting-help">If disabled, the dashboard uses built-in demo data.</p>
                </div>
                <div class="setting-group">
                    <label>Accounts to include</label>
                    <div id="accountsFilter" class="accounts-filter">
                        <p class="setting-help">Login required to load accounts.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="saveSettings">Save Settings</button>
            </div>
        </div>
    </div>
    
    <!-- AOS (Animate On Scroll) -->
    <link rel="stylesheet"
          href="https://unpkg.com/aos@2.3.1/dist/aos.css"
          integrity="sha384-/rJKQnzOkEo+daG0jMjU1IwwY9unxt1NBw3Ef2fmOJ3PW/TfAg2KXVoWwMZQZtw9"
          crossorigin="anonymous">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"
            integrity="sha384-wziAfh6b/qT+3LrqebF9WeK4+J5sehS6FA10J1t3a866kJ/fvU5UwofWnQyzLtwu"
            crossorigin="anonymous"></script>
    
    <!-- Main Application Script -->
    <script src="app.js"></script>
    
    <script>
        // Initialize AOS (Animate On Scroll)
        AOS.init({
            duration: 800,
            easing: 'ease-out-cubic',
            once: true,
            offset: 50
        });
    </script>
</body>
</html>
